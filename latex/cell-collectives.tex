\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts

% Core packages
\usepackage{cite}
\usepackage[T1]{fontenc}
\usepackage{hyperref}

% Math packages
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{array,booktabs}

% Graphics and layout
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{float}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{balance}

% Algorithm and code
\usepackage{algorithm}
\usepackage{algpseudocode} 
\usepackage{algorithmicx}
\usepackage{listings}

% Text and formatting
\usepackage{textcomp}
\usepackage{url}
\usepackage{enumitem}
\usepackage{caption} 
\usepackage{tcolorbox}
\usepackage{empheq}
\usepackage{varwidth}
\usepackage{balance}
\usepackage{todonotes}
 
\usepackage[ngerman,main=english]{babel}
 
% TikZ for diagrams
\usepackage{tikz}
\usetikzlibrary{arrows.meta,shapes,positioning}
\usetikzlibrary{calc,angles,quotes}

% --- Macro for drawing a 2D spherocylinder ---
% #1 = center coordinate
% #2 = rotation angle
% #3 = half-length
% #4 = radius
\newcommand{\drawSpherocyl}[4]{
    \begin{scope}[shift={(#1)},rotate=#2]
        \draw[line width=1pt,rounded corners=6pt] (-#3 + #4,#4) -- (#3 - #4,#4);
        \draw[line width=1pt,rounded corners=6pt] (-#3 + #4,-#4) -- (#3 - #4,-#4);
        \draw[line width=1pt,rounded corners=6pt] (#3 - #4,-#4) arc[start angle=-90,end angle=90,radius=#4];
        \draw[line width=1pt,rounded corners=6pt] (-#3 + #4,#4) arc[start angle=90,end angle=270,radius=#4];
        \fill [black] (#1) circle (2pt);
    \end{scope}
}



\hypersetup{hidelinks}
\DeclareMathAlphabet\mathbfcal{OMS}{cmsy}{b}{n}

% Macro for growth comparison row
\newlength{\subfigwidth}
\setlength{\subfigwidth}{0.2\textwidth}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}

\newcommand{\growthcomparisonrow}[6]{%
    #1 &
    \begin{subfigure}[b]{\subfigwidth}
        \includegraphics[width=\textwidth]{figures/growth_comparison_lambda_#2/#1_#2.#3.jpeg}
    \end{subfigure} &
    \begin{subfigure}[b]{\subfigwidth}
        \includegraphics[width=\textwidth]{figures/growth_comparison_lambda_#2/#1_#2.#4.jpeg}
    \end{subfigure} &
    \begin{subfigure}[b]{\subfigwidth}
        \includegraphics[width=\textwidth]{figures/growth_comparison_lambda_#2/#1_#2.#5.jpeg}
    \end{subfigure} &
    \begin{subfigure}[b]{\subfigwidth}
        \includegraphics[width=\textwidth]{figures/growth_comparison_lambda_#2/#1_#2.#6.jpeg}
    \end{subfigure}  \\
}

\begin{document}

\title{Proliferating Cell Collectives: \\A Comparison of Hard and Soft Collision Models}

\author{
    \IEEEauthorblockN{Manuel Lerchner}
    \IEEEauthorblockA{
        \textit{Technical University of Munich}\\
        Munich, Germany}
}

\maketitle

\begin{abstract}
    This work investigates the computational modeling of proliferating cell collectives, comparing an established constraint-based collision model as developed by Weady et al.~\cite{Weady2024} with a simpler potential-based collision model employing a nonlinear Hertzian contact law. While both approaches are demonstrated to reproduce key emergent patterns observed in bacterial colony growth, we highlight that  ...............

\end{abstract}

\begin{IEEEkeywords}
    active matter, cell collectives, particle simulation, soft collision model, hard collision model, pattern formation, computational biology, performance comparison, agent-based modeling
\end{IEEEkeywords}

\section{Introduction}
\subsection{Biological Motivation}

The collective behaviors of biological entities, ranging from simple microbial colonies to complex multicellular tissues, are fundamental to understanding the intricate processes of life. These systems often exhibit emergent spatio-temporal patterns, driven by the interplay of simple local interactions and individual growth dynamics. Bacterial colonies, for instance, showcase remarkable self-organization, developing sophisticated spatial structures in response to environmental stimuli. Specifically, experimental observations have highlighted the phenomenon of growth rate reduction in the colony's center due to mechanical pressure exerted by surrounding cells~\cite{Wittmann2023}. For various bacteria, such as E. coli, Bacillus subtilis, and Proteus mirabilis, and fungi like Setosphaeria rostrata and Exserohilum Turcicum, this pressure-induced deceleration contributes to the formation of characteristic concentric ring patterns~\cite{YAMAZAKI2005136}.

\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{figures/real-bacteria/Exserohilum turcicum.png}
    \caption{Morphology of \textit{Exserohilum turcicum}. The left image displays a colony of Exserohilum turcicum, while the right image shows a single cell of the same species. Source:~\cite{Bankole2023}.}
    \label{fig:exserohilum_turcicum}
\end{figure}

These phenomena pose significant computational challenges, demanding the accurate integration of both mechanical cell interactions and proliferation dynamics.

This work is directly inspired by these observations, particularly the formation of concentric rings in growing bacterial communities. These patterns represent a key manifestation of self-organization under controlled conditions, as further explored in~\cite{Weady2024}. Comprehending these emergent structures necessitates robust computational models capable of capturing the dynamic interplay between individual cell mechanics, intercellular interactions, and proliferation.

\subsection{Computational Challenges}

Simulating large populations of interacting and proliferating agents, such as individual cells, presents substantial computational hurdles. Accurately representing the dynamics of active matter systems where particles interact with each other and alter the system composition through growth, demands the development of efficient algorithms. A critical challenge lies in the accurate and stable resolution of inter-particle interactions, especially in the context of collisions.

Existing constraint-based (hard) collision models, which enforce strict non-overlapping conditions via an optimization framework, offer high physical precision. However, they can incur significant computational overhead, as constraints typically require iterative, global resolution across the entire system at each simulation step. This process can become a considerable bottleneck, particularly for simulations involving vast numbers of particles or frequent collision events.

In contrast, potential-based (soft) collision models, which permit minor overlaps and employ repulsive forces to manage interactions, provide a computationally more tractable alternative by relying solely on local computations.

Moreover, these two approaches may exhibit different stability constraints on the simulation step size, with soft collision models often requiring smaller steps to maintain numerical stability, whereas hard models may tolerate larger steps. \todo{check}

% TODO: quantify or explore step size differences for both approaches

Despite the established trade-offs, the comparative effectiveness of hard versus soft collision models in accurately reproducing biologically relevant patterns and their computational performance within the context of proliferating cell collectives remains an underexplored area. This research aims to address this gap by systematically comparing these two modeling approaches by investigating the computational performance of both models and their ability to reproduce biologically relevant patterns.



\section{Related Work}

The simulation of collective biological behaviors, such as bacterial colony formation, relies on agent-based models (ABMs) that capture individual cell mechanics and proliferation. A critical computational challenge in these ABMs is the efficient and accurate resolution of cell-cell collisions. This section reviews the two primary collision modeling paradigms and identifies a significant gap in their comparative benchmarking from a high-performance computing (HPC) perspective.

\subsection{Collision Modeling Paradigms}

Two primary paradigms exist for handling collisions in ABMs: potential-based (soft) and constraint-based (hard) models.

\begin{description}[style=nextline]
    \item[Potential-Based (Soft) Collision Models]
        These models manage interactions by employing repulsive forces, defined by potentials like Hertzian or Lennard-Jones, when agents overlap. Their primary advantage is computational tractability, as they rely on local force calculations that are highly amenable to parallelization. This has enabled large-scale simulations, such as the work by \cite{Warren2019}, who modeled millions of cells in 3D. However, a well-known limitation is numerical stiffness, which forces the use of small integration timesteps. Furthermore, as noted by \cite{Yan2019}, the finite range of repulsive forces causes particles to behave as soft and deformable, leading to an "effective" diameter smaller than the intended geometric size.

    \item[Constraint-Based (Hard) Collision Models]
        These models enforce strict non-overlapping geometric constraints, ensuring high physical fidelity by treating agents as truly impenetrable. A notable application is the work of \cite{Rudge2012}, who simulated growing bacterial colonies using a constraint-based method. They highlighted its computational intensity, often requiring solutions to large constraint systems, but demonstrated the feasibility of simulating tens of thousands of cells with GPU acceleration. The method of \cite{Yan2019} presents a advanced hard constraint approach that specifically addresses the drawbacks of soft models: it eliminates numerical stiffness—allowing timesteps to be increased by 10–100 times—and guarantees particles maintain their precise geometric dimensions.

\end{description}

\subsection{The Benchmarking Gap}

The reviewed literature reveals a clear dichotomy. Soft models offer computational simplicity and have been scaled to high agent counts, but at the cost of numerical stiffness and compromised physical fidelity. Hard models, particularly modern implementations like that of \cite{Yan2019}, offer a solution to these limitations, promising greater timesteps and rigorous geometry.

However, this presents a critical, unquantified trade-off: does the hard model's ability to take larger timesteps outweigh its inherently higher computational cost per timestep? This question is especially pertinent in simulations of proliferating cell collectives, where exponentially increasing density dramatically alters the computational load of the collision resolution algorithm.

A systematic benchmarking focusing on this computational trade-off between the models is largely absent. Existing studies~\cite{Rudge2012,Weady2024,Blanchard2015,Ghosh2015,You2018,Warren2019,Khan_2024} typically validate their models by comparing simulation results to experimental data (e.g., microscopy images of bacterial colonies)~\cite{Rudge2012,Khan_2024, Rudge2013,Langeslay_2023, Ghosh2015}, prioritizing biological insights over a rigorous HPC analysis of runtime, scalability, and numerical stability under proliferation. Consequently, there is no clear guidance for modelers on which paradigm is more efficient for a given problem scale. This work aims to fill this gap by implementing both models within a unified ABM framework to provide a direct, quantitative comparison of their computational performance.

\section{Cell Mechanics}

The mechanical representation of cells is a critical factor in determining simulation outcomes. For many bacteria and fungal hyphae, approximating them as rigid rods is a reasonable simplification that captures their elongated morphology and the primary drivers of their collective behavior. Although real cells can deform, treating them as rigid bodies allows us to focus on emergent collective dynamics. This choice of a rigid rod geometry is well-supported by the experimental observations that inspire our work and aligns with established practices in modeling microbial systems. The following collision models are applied to these rigid rod entities.

\subsection{Physical Cell Model}

We model the cell collective using a rigid rod representation, where each cell has a defined length and radius. This approach is common in models of cellular collectives~\cite{You2018, Weady2024, Blanchard2015, Warren2019, Ghosh2015} and is justified by experimental evidence, closely matching the morphology of common bacteria and fungi such as E. coli and Setosphaeria rostrata (see \autoref{fig:exserohilum_turcicum}).

Each bacterium is modeled as a spherocylinder with an initial length $\ell_0 = 1$ and diameter $d = 0.5$. At the bacterial scale, the Reynolds number is extremely small (Re $\ll 1$), placing the system firmly in the overdamped regime where viscous forces dominate inertial forces~\cite{datta2024lifelowreynoldsnumber}. Consequently, the dynamics are governed by the overdamped Langevin equation:

\begin{equation} \label{eq:overdamped_langevin}
    \frac{d \mathbf{x}_i}{dt} = \frac{1}{\zeta l_i} \sum_j \mathbf{F}_{ij}, \quad \frac{d \boldsymbol{\omega}_i}{dt} = \frac{12}{\zeta l_i^3} \sum_j (\mathbf{r}_{ij} \times \mathbf{F}_{ij})
\end{equation}

where $\mathbf{x}i$ is the position of the $i$-th cell, $\boldsymbol{\omega}i$ is its orientation, and $\mathbf{F}_{ij}$ is the force exerted on cell $i$ by cell $j$. The constant $\zeta$ is a drag coefficient representing friction with the surrounding fluid, and $\mathbf{r}_{ij}$ is the vector from the center of cell $i$ to the point of contact with cell $j$.

\autoref{fig:spherocylinder_model} illustrates the spherocylinder model and the forces and torques acting on cells during a collision.


\subsection{Cell Growth and Division}

Bacterial cells grow along their longitudinal axis according to the following model, adapted from~\cite{Weady2024}:

\begin{equation} \label{eq:growth}
    \dot{{\ell_i}} = \frac{{\ell_i}}{\tau} e^{\lambda \sigma_i}
\end{equation}

where $\tau$ is a characteristic time scale, $\sigma_i$ is the compressive stress along the cell's main axis, and $\lambda$ is a stress sensitivity parameter. This parameter controls the growth rate and ultimately the macroscopic pattern formation of the colony. The stress $\sigma_i$ on each cell is computed by projecting all contact forces onto the cell's longitudinal axis, defined by the unit tangent vector $\hat{\mathbf{t}}_i$~\cite{Weady2024}:

\begin{equation} \label{eq:stress}
    \sigma_i = \sum_{j} \frac{1}{2}\, \hat{\mathbf t}_i \cdot \mathbf F_{ij}
\end{equation}


A cell divides into two daughter cells once it reaches a critical length ($\ell_\text{div} = 2\ell_0$). To prevent artificial synchronization of division events, we introduce randomness in the daughter cells' lengths, which are randomly set between $0.98\ell_0$ and $1.02\ell_0$, following the approach in~\cite{Khan_2024}.

\subsection{Rotational Diffusion}

Moreover, we add a small random rotational perturbation to the orientation of all cells at each timestep to account for Brownian rotational diffusion. This small pertubation ensures that the cells break perfect alignment over time, which is important for realistic colony morphology.


\begin{figure}[H]
    \centering


    \begin{tikzpicture}[line cap=round,line join=round,>=Stealth]

        % --- Variables ---
        \coordinate (xi) at (0.8,-0.5);
        \coordinate (xj) at (1.4,-1.8);

        \coordinate (x) at (-3,-0.5);
        \def\R{0.5}

        \drawSpherocyl{xi}{-10}{1.4}{\R}
        \drawSpherocyl{xj}{15}{1.3}{\R}

        \coordinate (contact) at  (1.85,-1.15);

        % Collision point
        \fill[black] (contact) circle (2pt) node[above right] {};

        % Force vector
        \draw[->,thick,red] (contact) -- ++($0.9*(-0.258,0.965)$) node[pos=0.9,left] {$\mathbf{F}_{ij}$};

        % Torque lever arm
        \draw[->,thick,blue,dashed] (xi) -- (contact) node[pos=0.2,below] {$\mathbf{r}_{ij}$};

        % Force vector
        \draw[->,thick,red] (contact) -- ++($0.8*(0.258,-0.965)$) node[pos=0.6,right] {$\mathbf{F}_{ji}$};

        % Torque lever arm
        \draw[->,thick,blue,dashed] (xj) -- (contact) node[pos=0.3,left] {$\mathbf{r}_{ji}$};



        % label at xi
        \node at (xi) [left] {$\mathbf{x}_i$};
        % label at xj
        \node at (xj) [below] {$\mathbf{x}_j$};


        \drawSpherocyl{x}{0}{2}{\R};

        % Add division constriction: two daughters forming
        \coordinate (left_daughter) at ($(x)+(-1,-1.25)$);
        \coordinate (right_daughter) at ($(x)+(1, -1.25)$);

        \drawSpherocyl{left_daughter}{0}{1}{\R};
        \drawSpherocyl{right_daughter}{0}{1}{\R};


        % label at x
        \node at (x) [below] {$\mathbf{x}$};
        % label at left daughter
        \node at (left_daughter) [below] {$\mathbf{x}_\text{left}$};
        % label at right daughter
        \node at (right_daughter) [below] {$\mathbf{x}_\text{right}$};

        \draw[<->,thick,dashed] ($(x) + (-2,1)$) -- ($(x) + (2,1)$) node[midway,above] {$2\ell_0$};

        \draw[<->,thick,dashed] ($(x) + (-1.5-\R-\R,-\R)$) -- ($(x) + (-1.5-\R-\R,\R)$) node[midway,left] {$d$};

        \draw[<->,thick,dashed] ($(right_daughter) + (-2.5-\R-\R,-\R)$) -- ($(right_daughter) + (-2.5-\R-\R,\R)$) node[midway,left] {$d$};

        \draw[<->,thick,dashed] ($(left_daughter) + (-1,-1)$) -- ($(left_daughter) + (1,-1)$) node[midway,below] {$\ell_0$};

        \draw[<->,thick,dashed] ($(right_daughter) + (-1,-1)$) -- ($(right_daughter) + (1,-1)$) node[midway,below] {$\ell_0$};



        % Resulting rotation around xi
        \draw[->,thick,orange]
        ($(xi)+(0.6,0.5)$) arc[start angle=0,end angle=160,radius=0.6]
        node[midway, below] {$\boldsymbol{\omega}_i$};


        % Resulting rotation around xj
        \draw[->,thick,orange]
        ($(xj)+(0.7,-0.5)$) arc[start angle=0,end angle=-150,radius=0.6]
        node[midway, above] {$\boldsymbol{\omega}_j$};

    \end{tikzpicture}
    \caption{2D schematic of the spherocylinder cell model. Each cell is represented as a rigid rod with length $\ell$ and diameter $d$. Cells grow along their longitudinal axis and divide into two daughter cells upon reaching a critical length of $2\ell_0$. Collisions generate contact forces $\mathbf{F}_{ij}$ and $\mathbf{F}_{ji}$ (red). Torque arises from the cross product of the lever arm $\mathbf{r}_{ij}$ (dashed blue) and the contact force, leading to changes in orientation $\boldsymbol{\omega}$ (orange).}
    \label{fig:spherocylinder_model}

\end{figure}

\newpage

\section{Computational Framework}

\subsection{Colony Representation}

For our implementation, we closely follow the approach described by Weady et al.~\cite{Weady2024} in their supplementary material. The entire bacterial colony is represented by a single global state vector $\mathbfcal{C} = [\dots, \mathbf{x}_n^\top, \mathbf{q}_n^\top, \dots]^\top \in \mathbb{R}^{7N}$, where $N$ is the number of cells. Each cell is represented by a 7-dimensional sub-vector consisting of a position vector $\mathbf{x}_n \in \mathbb{R}^3$ and a unit quaternion $\mathbf{q}_n \in \mathbb{R}^4$ representing its orientation. The lengths of all cells are stored separately in a vector $\boldsymbol{\ell} = [\dots, \ell_n, \dots]^\top \in \mathbb{R}^{N}$.

\subsection{Colony Dynamics}

The translational and angular velocities of all particles in the colony are determined by the force-velocity relationship $\mathbfcal{U} = \mathbfcal{M} \mathbfcal{F}$. Here, $\mathbfcal{F}$ is the generalized force vector for the entire colony, containing both force and torque components for each cell. Similarly, $\mathbfcal{U}$ is the generalized velocity vector containing the resulting translational and angular velocities. These vectors are structured as follows:

\begin{itemize}
    \item
          $\mathbfcal{F} = [\dots, \mathbf{f}_n^\top, \boldsymbol{\tau}_n^\top, \dots]^\top \in \mathbb{R}^{6N}$ represents the force $\mathbf{f}_n$ and torque $\boldsymbol{\tau}_n$ for the $n$-th cell.
    \item
          $\mathbfcal{M} = \text{diag}([\dots, \frac{1}{\zeta l_n}\mathbf{I}, \frac{12}{\zeta l_n^3}\mathbf{I}, \dots]) \in \mathbb{R}^{6N \times 6N}$ is a block-diagonal mobility matrix, where each block contains the inverse of the cell's linear and angular mobility coefficients (from Eq.~\ref{eq:overdamped_langevin}) multiplied by an identity matrix $\mathbf{I}$ of appropriate size.
    \item
          $\mathbfcal{U} = [\dots, \mathbf{u}_n^\top, \boldsymbol{\omega}_n^\top, \dots]^\top \in \mathbb{R}^{6N}$ represents the resulting translational velocity $\mathbf{u}_n$ and angular velocity $\boldsymbol{\omega}_n$ for the $n$-th cell.
\end{itemize}


Combined with a mapping function $\mathbfcal{G}$, which converts Cartesian translational and angular velocities from $\mathbb{R}^{6N}$ to the corresponding changes in position and quaternion in $\mathbb{R}^{7N}$ (as described in~\cite{Weady2024}), we can express the colony's state update for an Euler timestep $\Delta t$ as:

\begin{equation} \label{eq:colony_update}
    \mathbfcal{C}^{k+1} = \mathbfcal{C}^k + \Delta t \, \mathbfcal{G} \mathbfcal{U} = \mathbfcal{C}^k + \Delta t \, \mathbfcal{G} \mathbfcal{M} \mathbfcal{F}
\end{equation}


The specific implementations of the hard and soft collision models are defined by how the generalized force vector $\mathbfcal{F}$ is computed in each case.

\newpage

\subsection{Soft Collision Model}

The soft collision model treats cell-cell interactions through a continuous, potential-based repulsion. This approach, inspired by~\cite{Warren2019} and~\cite{You2018}, generates forces that smoothly increase as cells deform against each other, preventing overlap in a physically realistic manner. We specifically implement a Hertzian contact model, which is well-suited for simulating the elastic deformation of curved, cell-like objects.

The repulsive elastic force exerted on cell $i$ by cell $j$ is calculated as:

\begin{equation} \label{eq:hertzian_contact_model}
    \mathbf{F}^{\text{elastic}}_{ij} = k_{cc} \sqrt{d_0} , \delta^{3/2} \, \hat{\mathbf{n}}
\end{equation}

where $\delta$ is the overlap distance between the two spherocylinders, $d_0$ is the cell diameter, $k_{cc}$ is an elastic constant, and $\hat{\mathbf{n}}$ is the unit normal vector at the point of contact. This nonlinear force-response is characteristic of Hertzian theory and provides a smooth onset of repulsion (see \autoref{fig:hertzian_contact_model}).

\subsubsection{Total Forces and Torques}

The total force $\mathbf{f}_n$ and torque $\boldsymbol{\tau}_n$ on the $n$-th cell are the sum of all pairwise elastic interactions with its neighbors and can be computed solely based on the elastic forces $\mathbf{F}^{\text{elastic}}_{nm}$:

\begin{equation}
    \mathbf{f}_n         = \sum_{m \neq n} \mathbf{F}^{\text{elastic}}_{nm} \qquad
    \boldsymbol{\tau}_n  = \sum_{m \neq n} \mathbf{r}_{nm} \times \mathbf{F}^{\text{elastic}}_{nm}
\end{equation}

These forces and torques are assembled into the global generalized force vector $\mathbfcal{F}$. The colony dynamics are then updated by inserting $\mathbfcal{F}$ into the force-velocity relation and applying the Euler integration step defined in \autoref{eq:colony_update}.

\subsubsection{Model Parameters}

The elastic constant $k_{cc}$ is a crucial parameter that determines the effective stiffness of the cells. Following~\cite{You2018}, we define it as the ratio of the cell's Young's modulus $Y$ to the fluid drag coefficient $\zeta$:

\begin{equation}
    k_{cc} = \frac{Y}{\zeta}
\end{equation}

Using typical values from the literature for bacteria ($Y \approx 4$ MPa~\cite{You2018, Blanchard2015} and $\zeta \approx 200$ Pa$\cdot$h~\cite{You2018}), we set $k_{cc} = 20000$ h$^{-1}$. The simulation uses a timestep of $\Delta t = 10^{-5}$ h, which is standard for maintaining numerical stability in such overdamped systems~\cite{Khan_2024, You2018, Blanchard2015}.

\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{figures/hertzian_contact_model.png}
    \caption{Force response of the Hertzian contact model. The repulsive force $\mathbf{F}^{\text{elastic}}$ scales non-linearly with the overlap distance, leading to a smooth increase in repulsion.}
    \label{fig:hertzian_contact_model}
\end{figure}

\subsection{Hard Collision Model}

The hard collision model enforces strict non-overlapping constraints between cells using a constraint-based method. For each pair of nearby cells, a constraint $\alpha$ is defined based on the two closest points, $\mathbf{y}_n$ and $\mathbf{y}_m$, on their surfaces.

Contrary to the soft Hertzian model, the hard model defines the force and torque from each constraint via an unknown scalar Lagrange multiplier $\gamma_\alpha$, which represents the magnitude of the impulse required to prevent penetration. The force on cell $n$ due to constraint $\alpha$ is:

\begin{equation} \label{eq:constraint_force}
    \mathbf{F}^{hard}_{n\alpha} = \hat{\mathbf{n}}_\alpha \gamma_\alpha
\end{equation}

where $\hat{\mathbf{n}}_\alpha$ is the normal vector at the contact point. The corresponding torque is $\boldsymbol{\tau}_{n\alpha} = (\mathbf{y}_n - \mathbf{x}_n) \times \hat{\mathbf{n}}_\alpha \gamma_\alpha$.

All $C$ constraint multipliers are collected into a vector $\boldsymbol{\gamma} \in \mathbb{R}^{C}$. The total generalized force vector $\mathbfcal{F}$ for the colony depends linearly on these multipliers:

\begin{equation}
    \mathbfcal{F}(\boldsymbol{\gamma}) = \mathbfcal{D} \boldsymbol{\gamma}
\end{equation}

where the sparse matrix $\mathbfcal{D} \in \mathbb{R}^{6N \times C}$ maps each multiplier to the resultant forces and torques on the involved cells.

\subsubsection{Constraint Resolution via a Nonlinear Complementarity Problem (NCP)}

The goal is to solve for multipliers $\boldsymbol{\gamma}$ that resolve all overlaps. The solution must satisfy three physical conditions:

\begin{enumerate}
    \item \textbf{Repulsive Forces:} $\boldsymbol{\gamma} \geq 0$. This ensures that the forces are repulsive, preventing cells from pulling on each other.
    \item \textbf{Non-Overlap:} $\mathbf{\Phi}^{k+1} \geq 0$ where $\mathbf{\Phi}^k = [\dots, \Phi_\alpha, \dots]^\top$ is the vector of signed separation distances at time step $k$. This condition ensures that after applying the forces, no cells overlap.
    \item   \textbf{Complementarity:} $\boldsymbol{\gamma} \perp \mathbf{\Phi}^{k+1}$. This ensures  that if force acts, the cells separation distance must be zero after the update. Conversely, if cells are not in contact after the update, the force must have been zero.
\end{enumerate}

These three conditions are often abbreviated as:

\begin{equation}
    \mathbf{0} \leq \boldsymbol{\gamma} \perp \mathbf{\Phi}^{k+1} \geq \mathbf{0}.
\end{equation}


The colony update rule and constraint condition combine to form a system where the future state $\mathbfcal{C}^{k+1}$ (and thus $\mathbf{\Phi}^{k+1}$) depends on $\boldsymbol{\gamma}$:

\begin{equation} \label{eq:colony_update_with_constraints}
    \begin{split}
        \mathbfcal{C}^{k+1} & = \mathbfcal{C}^k + \Delta t \mathbfcal{G} \mathbfcal{M} \mathbfcal{F}(\boldsymbol{\gamma})         \\
        \text{ s.t.} \quad  & \mathbf{0} \leq \boldsymbol{\gamma} \perp \mathbf{\Phi}^{k+1}(\boldsymbol{\gamma}) \geq \mathbf{0}.
    \end{split}
\end{equation}

The central challenge is that $\mathbf{\Phi}^{k+1}(\boldsymbol{\gamma})$ is a nonlinear function of the updated state $\mathbfcal{C}^{k+1}$. Weady et al.~\cite{Weady2024} linearize this relationship using a first-order Taylor expansion around the current state $\mathbfcal{C}^k$:

\begin{equation}\label{eq:phi_expanded}
    \begin{split}
        \mathbf{\Phi}^{k+1} & \approx \mathbf{\Phi}^k + \Delta t \left( \mathbfcal{D}^\top  \mathbfcal{G}^\top  \dot{\mathbfcal{C}}^k - \mathbfcal{L}^\top\dot{\boldsymbol{\ell}} \right)\\
        & = \mathbf{\Phi}^k + \Delta t \Biggl( \mathbfcal{D}^\top
        \mathbfcal{M} \mathbfcal{D} \boldsymbol{\gamma}   - \mathbfcal{L}^\top  \frac{\boldsymbol{\ell}} {\tau} e^{-\lambda \mathbfcal{L} \boldsymbol{\gamma } } \Biggr)
    \end{split}
\end{equation}

The change in separation distances depends on two factors:

\begin{enumerate}
    \item \textbf{Cell Motion:} The term $\mathbfcal{D}^\top \mathbfcal{M} \mathbfcal{D} \boldsymbol{\gamma}$ represents how constraint forces induce motion that changes $\mathbf{\Phi}^{k+1}$.
    \item \textbf{Cell Growth:} The term $\mathbfcal{L}^\top \frac{\boldsymbol{\ell}}{\tau} e^{-\lambda \mathbfcal{L} \boldsymbol{\gamma}}$ accounts for how independent cell growth affects the separation distances. The matrix $\mathbfcal{L} \in \mathbb{R}^{N \times C}$ encodes the sensitivity of each constraint $\alpha$ and is used to calculate the stress vector $\boldsymbol{\sigma} = \mathbfcal{L} \boldsymbol{\gamma}$ for the entire colony,
          as described in \autoref{eq:stress}.
\end{enumerate}

Substituting the approximation from \autoref{eq:phi_expanded} into the constraint conditions of \autoref{eq:colony_update_with_constraints} yields a nonlinear complementarity problem (NCP) for $\boldsymbol{\gamma}$:

\begin{empheq}[box=\fbox]{equation} \label{eq:ncp_boxed}
    \small
    \begin{aligned}
         & \text{Find } \boldsymbol{\gamma} \ \text{such that} \\
         & \mathbf{0} \leq \boldsymbol{\gamma} \perp
        \boldsymbol{\Phi}^k
        + \Delta t \Biggl(
        \mathbfcal{D}^\top \mathbfcal{M} \mathbfcal{D} \boldsymbol{\gamma}
        - \mathbfcal{L}^\top
        \tfrac{\boldsymbol{\ell}}{\tau}
        e^{-\lambda \mathbfcal{L}\boldsymbol{\gamma}}
        \Biggr) \ge \mathbf{0}.
    \end{aligned}
\end{empheq}

\subsubsection{Energy Minimization Solution}

This NCP is equivalent to the first-order optimality condition for minimizing a convex energy function subject to $\boldsymbol{\gamma} \ge \mathbf{0}$~\cite{Yan2019}:

\begin{equation}
    \small
    \begin{aligned}
        E(\boldsymbol{\gamma}) =
        \boldsymbol{\gamma}^\top\boldsymbol{\Phi}^k
         & + \frac{\Delta t}{2} \boldsymbol{\gamma}^\top \mathbfcal{D}^\top \mathbfcal{M} \mathbfcal{D} \boldsymbol{\gamma} \\
         & + \mathbf{1}^\top \frac{\Delta t}{\lambda}
        \left( \frac{\boldsymbol{\ell}}{\tau} e^{-\lambda \mathbfcal{L} \boldsymbol{\gamma}} \right)                        \\
    \end{aligned}
\end{equation}

A central property of this energy function is that its gradient yields the linearized prediction of the vector of signed separation distances for the next time step: $\nabla_{\boldsymbol{\gamma}} E = \boldsymbol{\Phi}^{k+1}$.

The equivalence between the NCP in \autoref{eq:ncp_boxed} and the first-order optimality (KKT) conditions for the minimization of $E(\boldsymbol{\gamma})$ is a standard result in optimization theory~\cite{Nocedal2006}.

This equivalence, combined with the physical interpretation of the gradient as the predicted separation $\boldsymbol{\Phi}^{k+1}$, ensures that the KKT conditions for the minimization problem directly map onto the NCP conditions. Specifically, at the optimum $\boldsymbol{\gamma}^*$:

\begin{itemize}
    \item \textbf{Primal feasibility} ($\boldsymbol{\gamma}^* \ge \mathbf{0}$) ensures the repulsive force condition is satisfied: $\boldsymbol{\gamma}^* \ge \mathbf{0}$.
    \item \textbf{Dual feasibility} ($\nabla E(\boldsymbol{\gamma}^*) \ge \mathbf{0}$) ensures the predicted separation is non-negative: $\boldsymbol{\Phi}^{k+1}(\boldsymbol{\gamma}^*) \ge \mathbf{0}$.
    \item \textbf{Complementary slackness} ($(\boldsymbol{\gamma}^*)^\top \nabla E(\boldsymbol{\gamma}^*) = 0$) ensures the perpendicularity condition: $\boldsymbol{\gamma}^* \perp \boldsymbol{\Phi}^{k+1}(\boldsymbol{\gamma}^*)$.
\end{itemize}

Since the energy function $E(\boldsymbol{\gamma})$ is convex, the optimal Lagrange multiplier vector $\boldsymbol{\gamma}^*$ is the unique global solution that resolves all contacts according to the physical laws of rigid body contact.

The solution to this constrained minimization problem is computed using the Barzilai-Borwein projected gradient descent method (BBPGD)~\cite{BBPGD}, also implemented in~\cite{Weady2024}. This method iteratively refines the estimate of $\boldsymbol{\gamma}$ by taking adaptive gradient steps while enforcing the non-negativity constraint through projection.

The algorithm continues until a convergence criteria is met, and the final solution $\boldsymbol{\gamma}^*$ is used to compute the generalized forces $\mathbfcal{F} = \mathbfcal{D}\boldsymbol{\gamma}^*$. The colony state is then updated using \autoref{eq:colony_update}. This process is repeated at each simulation timestep to ensure that all collisions are resolved while maintaining the physical integrity of the cell collective.

\newpage

\section{Implementation}

All simulations in this paper were performed with a custom C++ framework developed for large-scale simulations of proliferating cell collectives. The framework is designed for distributed-memory parallel computing and leverages standard HPC libraries to ensure scalability and efficiency. Its core components are:

\subsection{Distributed Computing Architecture}

The core architecture is built on two foundational libraries:
\begin{itemize}
    \item PETSc~\cite{petsc-web-page}, used as a backend for distributed vectors and sparse matrices. PETSc partitions data across MPI processes, transparently handling inter-process communication so that global operations (e.g., matrix-vector products, reductions) can be expressed at a high level.
    \item MPI, which underlies all inter-process communication, including ghost-cell exchanges at domain boundaries to enable consistent collision handling across partitions.
\end{itemize}

On top of these abstractions, the framework implements the full physics pipeline, including the ReLCP solver for the hard collision model~\cite{Weady2024} and the soft collision model.


\subsection{Collision Handling Pipeline}

Collisions are processed through a unified pipeline. A spatial grid enables broad-phase detection, reducing neighbor searches to $O(N)$, followed by narrow-phase detection that computes exact contact points. For each collision, the framework assembles a standardized data package containing:

\begin{itemize}
    \item Contact point in world coordinates.
    \item Normal vector $\hat{\mathbf{n}}$ at the contact.
    \item Torque arms from the contact point to each cell center.
    \item Overlap distance $\delta$ (soft model).
    \item Unique identifiers of the two cells.
\end{itemize}

This abstraction decouples geometry from physics: both collision models consume the same data structure but compute the resulting forces differently. This design allows easy extension to new collision models in the future.

\subsection{Simulation Output}

Simulation results are written in \texttt{VTK} format, which can be directly visualized with ParaView~\cite{ahrens2005paraview}. This includes both raw particle and field data, as well as derived quantities such as contact forces or stresses.
All figures presented in the following sections, together with the data used for plots, were extracted from these ParaView outputs. This workflow ensures consistency between visualizations and quantitative analysis, while also enabling interactive inspection of the simulated cell collectives.


\subsection{Availability}

The full simulation framework, including all features and implementations described in this work, is openly available on GitHub at \url{https://github.com/manuellerchner/MicrobeGrowthSim-IDP}.
The repository enables reproduction of the presented results as well as adaptation of the framework for related research problems.

\section{Pattern Formation Analysis}

\subsection{Concentric Ring Patterns}

We begin by validating our implementations through the reproduction of concentric ring patterns that arise under stress-sensitive growth, as reported in~\cite{Weady2024}. Simulations were performed for $\lambda = 10^{-1}, 10^{-2}, 10^{-3}$ using both hard and soft collision models. As shown in \autoref{fig:pattern_formation}, both models successfully produce qualitatively similar ring structures. This demonstrates that the soft collision model, despite its simpler formulation, can capture the essential dynamics responsible for these macroscopic patterns, making it a viable and potentially more efficient option for studying pattern formation.

Importantly, the soft model reproduces the expected concentric rings while employing a substantially simplified approach to collision resolution. This further supports its suitability as an alternative to the more complex hard collision model when the goal is to replicate such emergent patterns.



\subsection{Microdommain formation}

~\cite{You2018}


\subsection{Alignment}

~\cite{You_2021}


\subsection{Quantitative Comparison}

To provide a more quantitative assessment, we analyze three key metrics: the radial distribution of stress, the radial distribution of packing fraction, and the maximum particle overlap over time. These metrics offer insights into the mechanical state of the colony and how it evolves under different collision models.

\autoref{fig:dense_packing_comparison} and \autoref{fig:radial_distribution_stress}--\autoref{fig:max_overlap_simulation} illustrate these results in detail While certain quantities, such as the packing fraction and the corresponding maximum overlap, differ between the two models, the overall macroscopic behavior remains similar, consistent with the pattern formation observed in \autoref{fig:pattern_formation}.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.49\columnwidth}
        \centering
        \includegraphics[width=\linewidth]{figures/comparisons/packing_hard.jpeg}
        \caption{Close-up of particle packing for the hard model.}
        \label{fig:packing_hard}
    \end{subfigure}
    \begin{subfigure}[b]{0.49\columnwidth}
        \centering
        \includegraphics[width=\linewidth]{figures/comparisons/packing_soft.jpeg}
        \caption{Close-up of particle packing for the soft model.}
        \label{fig:packing_soft}
    \end{subfigure}
    \caption{Close-up comparison of particle packing. The soft model exhibits denser packing with slight particle overlap, while the hard model maintains strict non-overlap. See \autoref{fig:radial_distribution_packing_fraction} for a quantitative comparison of packing fractions.}
    \label{fig:dense_packing_comparison}
\end{figure}



\newpage

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figures/comparisons/radial_distribution_stress.png}
        \caption{Comparison of radial stress distributions for the hard and soft collision models. Both models roughly reproduce the analytically derived stress profiles~\cite{Weady2024}.}
        \label{fig:radial_distribution_stress}
    \end{subfigure}

    \vspace{0.5em}

    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figures/comparisons/radial_distribution_packing_fraction.png}
        \caption{Radial packing fraction. The soft model reaches $\approx1.2$ at the center due to overlap, while the hard model stays below 1. The packing fraction is defined as the total area occupied by particles within a radial shell divided by the shell area.}
        \label{fig:radial_distribution_packing_fraction}
    \end{subfigure}

    \vspace{0.5em}

    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figures/comparisons/max_overlap_simulation.png}
        \caption{Maximum particle overlap. Overlap grows over time in the soft model, while the hard model is kept near a constant value set by the tolerance hyperparameter.}
        \label{fig:max_overlap_simulation}
    \end{subfigure}

    \caption{Comparison of hard and soft collision models: (a) radial stress distributions, (b) radial packing fraction, and (c) maximum particle overlap.}
    \label{fig:comparison_all}
\end{figure}

\begin{figure*}[p]
    \centering

    % Lambda = 10^-1 comparison
    \begin{subfigure}[b]{\textwidth}
        \centering
        \caption{Growth Comparison $\lambda=10^{-1}$}
        \begin{tabular}{r M{\subfigwidth} M{\subfigwidth} M{\subfigwidth} M{\subfigwidth}}
            \growthcomparisonrow{Hard}{1e-1}{0400}{0800}{1200}{1800}
            \growthcomparisonrow{Soft}{1e-1}{0400}{0800}{1200}{1800}
        \end{tabular}
    \end{subfigure}

    % % Lambda = 10^-2 comparison
    \begin{subfigure}[b]{\textwidth}
        \centering
        \caption{Growth Comparison $\lambda=10^{-2}$}
        \begin{tabular}{r M{\subfigwidth} M{\subfigwidth} M{\subfigwidth} M{\subfigwidth}}
            \growthcomparisonrow{Hard}{1e-2}{0400}{0700}{0900}{1100}
            \growthcomparisonrow{Soft}{1e-2}{0400}{0700}{0900}{1100}
        \end{tabular}
    \end{subfigure}

    % Lambda = 10^-3 comparison
    \begin{subfigure}[b]{\textwidth}
        \centering
        \caption{Growth Comparison $\lambda=10^{-3}$}
        \begin{tabular}{r M{\subfigwidth} M{\subfigwidth} M{\subfigwidth} M{\subfigwidth}}
            \growthcomparisonrow{Hard}{1e-3}{0400}{0600}{0800}{1000}
            \growthcomparisonrow{Soft}{1e-3}{0400}{0600}{0800}{1000}
        \end{tabular}
    \end{subfigure}


    \caption{Pattern formation under stress-sensitive growth at equally spaced time points. Each row shows the evolution for a different value of $\lambda$ for both hard and soft collision models up to a maximum colony radius of 50. The color indicates the length of the cells ranging from 1 (dark green) to 2 (light green). Clear concentric ring pattern are visible for $\lambda \in \{10^{-2}, 10^{-3}\}$.}
    \label{fig:pattern_formation}
\end{figure*}





\newpage

\section{Computational Performance}

Both models reproduce the observed patterns, but their computational requirements differ substantially.
The hard collision model requires solving a gradient-based optimization problem at each time step,
while the soft collision model relies on direct force calculations that can be implemented efficiently
with standard molecular dynamics techniques such as Linked-Cells or Verlet lists~\cite{Gratl2019}.

\subsection{Computational Complexity and Scalability}
\label{sec:complexity_scalability}

The key distinction between the two approaches lies in how computations and communication are distributed.
The hard collision model incurs a significant per-step cost, since each time step requires the iterative
solution of a global optimization problem. This introduces a computational bottleneck and limits scalability:
all processors must participate in the solver and exchange data about the entire system at every iteration.

In contrast, the soft collision model evaluates only local interactions. Its computations scale linearly
with particle number, and locality ensures that communication in parallel implementations is restricted
to neighboring subdomains. This enables efficient scaling to larger systems and higher processor counts.

\autoref{fig:wall_time_simulation} shows the total wall time for simulations of both models
as a function of particle number for $\lambda = 10^{-2}$.
The soft model consistently outperforms the hard model, with a speedup factor of about 1.8x across all tested system sizes.


% 4. Per-Particle Cost

% Wall time per particle vs. particle number (log-log).
% Motivation: Reveal scaling law .


% 5. Communication vs. Computation Breakdown

% Fraction of time spent in:
% Force evaluation (soft model)
% Solver iterations (hard model)
% Communication (MPI)

\subsection{Performance}
\cite{Yan2019}


\subsection{Critical Time Step}

While the soft collision model is cheaper per interaction, it typically requires smaller integration time steps
to maintain numerical stability. This constraint can offset some of its per-step performance advantage
in long simulations, depending on the stiffness of the system.

\subsection{Solver Behavior in the Hard Model}

\autoref{fig:bbpgd_iterations_simulation} illustrates the number of ReLCP solver iterations required per time step in the hard collision model.


\subsection{Strong and Weak Scaling}

TODO

\subsection{Insights into BBPGD Iterations}

TODO



\subsection{Insights into BBPGD Iterations}

Which time step results in fastest colonry radius in a fixed amout of wall time?



\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{figures/comparisons/wall_time_simulation.png}
    \caption{Total simulation time for the hard and soft collision models as a function of particle number. The soft model is generally faster by a factor of 1.8.} \label{fig:wall_time_simulation}
\end{figure}

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{figures/comparisons/bbpgd_iterations_simulation.png}
    \caption{ReLCP solver iterations in the hard collision model. To enforce particle separation, the model must iteratively solve an LCP at each time step, with the required number of iterations increasing with particle count.} \label{fig:bbpgd_iterations_simulation}
\end{figure}

\newpage
\clearpage

\section{Discussion}

\subsection{Model Selection Insights}

The choice between hard and soft collision models involves a clear trade-off between physical fidelity and computational efficiency.
The hard model enforces strict non-overlap, which can be useful for capturing precise mechanical interactions or stress distributions in densely packed cell populations. However, it comes at considerable computational cost, requiring iterative global solvers and limiting scalability to large systems or long simulations.

By contrast, the soft model uses continuous repulsive potentials to approximate collisions. This approach is computationally efficient and scalable, making it well-suited for exploring large colonies or wide parameter spaces.

Importantly, for many emergent pattern-formation scenarios—such as concentric ring formation—the exact enforcement of non-overlap seems less critical. Other factors, such as stress-dependent growth and a use of an adequate time step, appear to dominate the macroscopic behavior.

In this context, the soft model provides a realistic approximation of cellular interactions: biological cells are deformable, and mechanical interactions in vivo are rarely perfectly rigid. Indeed, recent studies \cite{Khan_2024, Ghosh2015, SantosDiaz2025} suggest that finite stiffness or soft repulsive forces are sufficient to capture key structural and morphological features of growing bacterial colonies.

\subsection{Biological Relevance}

Our results indicate that the soft collision model successfully reproduces major emergent patterns despite its simplified mechanics. This aligns with the view that colony-level behaviors are robust to the details of individual cell interactions, provided that key features like stress-dependent growth are captured.

Furthermore, the soft model naturally represents continuous pressure and proximity effects, which are biologically more plausible than instantaneous, perfectly rigid constraints. This makes it a compelling choice for simulating biological systems where cells exhibit elasticity and deformability.

\section{Conclusion}

This paper demonstrates that a computationally efficient soft collision model can reproduce complex emergent patterns in proliferating cell collectives, including concentric rings observed in bacterial colonies.

While hard collision models offer exact non-overlap and may be valuable when studying precise mechanical stresses or jamming phenomena, they are computationally intensive and less scalable. Soft models, using finite repulsion to approximate contact interactions, achieve a realistic balance between biological plausibility and computational performance.

\newpage
\section{Future Work}

The current implementation provides a functional baseline for hard collision modeling, yet significant opportunities exist for performance optimization in the constraint solver.

\subsection{Hard Collision Model}
The present PETSc-based implementation of the ReLCP constraint solver faces computational bottlenecks that limit its scalability, primarily due to dynamic memory management strategies for constraint matrices and vectors. While an allocation factor mitigates frequent reallocations, sudden increases in collision events still trigger costly memory recopies. Furthermore, allocated memory is not reused between solver iterations, necessitating complete cleanup and reallocation at each time step.

Future work should focus on developing a more sophisticated memory management strategy that leverages PETSc's advanced features, such as memory pooling for constraint matrices and vectors, matrix preallocation routines with accurate nonzero pattern prediction, and incremental growth strategies to minimize MPI synchronization overhead.

\subsection{Soft Collision Model}

Beyond optimizing the hard model's solver, a promising avenue is the acceleration of the soft model using advanced molecular dynamics techniques. Libraries like AutoPas\cite{AutoPasGithub,Gratl2019,Newcome2023} offer a node-level auto-tuning framework specifically designed for particle simulations.AutoPas can dynamically select the optimal combination of algorithms (e.g., for particle interaction traversal and container data structures) tailored to the specific simulation scenario and underlying hardware architecture.

Integrating such a framework could automatically accelerate the computation of repulsive forces in the soft collision model, especially for large-scale colonies where efficient neighbor-search and force evaluation are critical.

\newpage

\balance
\bibliographystyle{IEEEtran}
\bibliography{literature}

\newpage
\tableofcontents

\end{document}